import streamlit as st
import openai

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(
    page_title="ìœ íŠœë¸Œ & íŒŸìºìŠ¤íŠ¸ ì¶”ì²œ ì±—ë´‡",
    page_icon="ğŸ“º",
    layout="wide"
)

# ë©”ì¸ íƒ€ì´í‹€
st.title("ğŸ“º ìœ íŠœë¸Œ & íŒŸìºìŠ¤íŠ¸ ì¶”ì²œ ì±—ë´‡")
st.markdown("### ë‹¹ì‹ ì˜ ê´€ì‹¬ì‚¬ì— ë§ëŠ” ì±„ë„ì„ ì°¾ì•„ë“œë ¤ìš”!")
st.markdown("---")

# ì‚¬ì´ë“œë°”
with st.sidebar:
    st.title("âš™ï¸ ì„¤ì •")
    
    # ê°„ë‹¨í•œ API í‚¤ ì…ë ¥
    st.markdown("#### API Key ì…ë ¥")
    api_key = st.text_input("OpenAI API Key:", type="password", placeholder="sk-...")
    
    st.markdown("---")
    st.title("ğŸ¯ ê´€ì‹¬ ë¶„ì•¼")
    
    categories = [
        "ì§ì ‘ ì…ë ¥í•˜ê¸°",
        "ğŸƒâ€â™‚ï¸ ìš´ë™/í—¬ìŠ¤/ì²´ì¡°",
        "ğŸ³ ìš”ë¦¬/ë ˆì‹œí”¼",
        "ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤/ìê¸°ê³„ë°œ", 
        "ğŸ¨ ì˜ˆìˆ /ì°½ì‘",
        "ğŸ’» IT/í”„ë¡œê·¸ë˜ë°",
        "ğŸ“š êµìœ¡/í•™ìŠµ",
        "ğŸµ ìŒì•…/ì—”í„°í…Œì¸ë¨¼íŠ¸",
        "ğŸ§˜â€â™€ï¸ ëª…ìƒ/íë§",
        "ğŸ’° íˆ¬ì/ì¬í…Œí¬",
        "ğŸŒ ì—¬í–‰/ë¬¸í™”",
        "ğŸ® ê²Œì„/ì·¨ë¯¸",
        "ğŸ‘¶ ìœ¡ì•„/êµìœ¡",
        "ğŸ  ì¸í…Œë¦¬ì–´/DIY",
        "ğŸ• ë°˜ë ¤ë™ë¬¼",
        "ğŸ“– ë…ì„œ/ì±…ë¦¬ë·°"
    ]
    
    selected_category = st.selectbox("ì¹´í…Œê³ ë¦¬ ì„ íƒ:", categories)
    
    if st.button("ğŸ” ì„ íƒí•œ ë¶„ì•¼ë¡œ ê²€ìƒ‰", type="primary"):
        if selected_category != "ì§ì ‘ ì…ë ¥í•˜ê¸°":
            st.session_state.selected_category = selected_category

# ë©”ì¸ ì½˜í…ì¸  ì˜ì—­
col1, col2 = st.columns([2, 1])

with col1:
    # ê´€ì‹¬ì‚¬ ì…ë ¥
    interest = st.text_area(
        "ğŸ¯ ì–´ë–¤ ì±„ë„ì„ ì°¾ê³  ê³„ì‹ ê°€ìš”? ê´€ì‹¬ì‚¬ë¥¼ ìì„¸íˆ ì•Œë ¤ì£¼ì„¸ìš”:",
        value=st.session_state.get('selected_category', ''),
        placeholder="ì˜ˆ: ì§‘ì—ì„œ í•  ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ í™ˆíŠ¸ë ˆì´ë‹ ì˜ìƒì„ ì°¾ê³  ìˆì–´ìš”. ì´ˆë³´ìë„ ë”°ë¼í•  ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œìš”.",
        height=100
    )
    
    # ì¶”ê°€ ì˜µì…˜
    with st.expander("ğŸ”§ ì„¸ë¶€ ì˜µì…˜"):
        col_a, col_b = st.columns(2)
        with col_a:
            platform = st.multiselect(
                "í”Œë«í¼ ì„ íƒ:", 
                ["ìœ íŠœë¸Œ", "íŒŸìºìŠ¤íŠ¸", "ë„¤ì´ë²„TV", "ì¸ìŠ¤íƒ€ê·¸ë¨"],
                default=["ìœ íŠœë¸Œ", "íŒŸìºìŠ¤íŠ¸"]
            )
            difficulty = st.selectbox("ë‚œì´ë„:", ["ìƒê´€ì—†ìŒ", "ì´ˆë³´ììš©", "ì¤‘ê¸‰ììš©", "ê³ ê¸‰ììš©"])
        with col_b:
            language = st.selectbox("ì–¸ì–´:", ["í•œêµ­ì–´", "ì˜ì–´", "ìƒê´€ì—†ìŒ"])
            duration = st.selectbox("ì˜ìƒ ê¸¸ì´:", ["ìƒê´€ì—†ìŒ", "ì§§ì€ ì˜ìƒ (10ë¶„ ì´ë‚´)", "ì¤‘ê°„ ê¸¸ì´ (10-30ë¶„)", "ê¸´ ì˜ìƒ (30ë¶„ ì´ìƒ)"])

with col2:
    st.markdown("### ğŸ“š ì´ìš© ê°€ì´ë“œ")
    st.info("""
    **ğŸ’¡ ë” ì •í™•í•œ ì¶”ì²œì„ ìœ„í•´:**
    
    â€¢ êµ¬ì²´ì ì¸ ê´€ì‹¬ì‚¬ ì„¤ëª…
    â€¢ ì›í•˜ëŠ” ì½˜í…ì¸  ìŠ¤íƒ€ì¼
    â€¢ í•™ìŠµ ëª©ì ì´ë‚˜ ì·¨ë¯¸ ëª©ì ì¸ì§€
    â€¢ ì„ í˜¸í•˜ëŠ” ì§„í–‰ ë°©ì‹
    
    **ğŸ¯ ì¶”ì²œ ë°›ì„ ìˆ˜ ìˆëŠ” ê²ƒ:**
    â€¢ ìœ íŠœë¸Œ ì±„ë„ & ì˜ìƒ
    â€¢ íŒŸìºìŠ¤íŠ¸ í”„ë¡œê·¸ë¨
    â€¢ ì¸ìŠ¤íƒ€ê·¸ë¨ ê³„ì •
    â€¢ ê´€ë ¨ ì»¤ë®¤ë‹ˆí‹°
    """)

# ì¶”ì²œ ë²„íŠ¼
if st.button("ğŸ¯ ë§ì¶¤ ì±„ë„ ì¶”ì²œë°›ê¸°", type="primary", use_container_width=True):
    if not api_key:
        st.error("âš ï¸ API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!")
    elif not interest.strip():
        st.warning("âš ï¸ ê´€ì‹¬ì‚¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!")
    else:
        # ì¶”ê°€ ì •ë³´ ì¡°í•©
        additional_info = f"í”Œë«í¼: {', '.join(platform)}, ë‚œì´ë„: {difficulty}, ì–¸ì–´: {language}, ì˜ìƒê¸¸ì´: {duration}"
        full_query = f"{interest}\n\n[ì¶”ê°€ì •ë³´: {additional_info}]"
        
        try:
            with st.spinner("ğŸ¤– AIê°€ ë‹¹ì‹ ì—ê²Œ ë§ëŠ” ì±„ë„ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤..."):
                openai.api_key = api_key
                
                system_prompt = """
ë‹¹ì‹ ì€ ìœ íŠœë¸Œì™€ íŒŸìºìŠ¤íŠ¸ ì „ë¬¸ íë ˆì´í„°ì…ë‹ˆë‹¤. 
ì‚¬ìš©ìì˜ ê´€ì‹¬ì‚¬ì— ë§ëŠ” ìµœê³ ì˜ ì±„ë„ë“¤ì„ ì¶”ì²œí•´ì£¼ì„¸ìš”.

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì •í™•íˆ ë‹µë³€í•´ì£¼ì„¸ìš”:

## ğŸ¯ ì¶”ì²œ ë¶„ì„
[ì‚¬ìš©ì ê´€ì‹¬ì‚¬ì— ëŒ€í•œ ë¶„ì„ê³¼ ì¶”ì²œ ë°©í–¥]

## ğŸ“º ìœ íŠœë¸Œ ì±„ë„ ì¶”ì²œ (3-5ê°œ)

### 1. [ì±„ë„ëª…]
**êµ¬ë…ì:** [êµ¬ë…ì ìˆ˜ ì •ë³´]
**íŠ¹ì§•:** [ì±„ë„ì˜ íŠ¹ìƒ‰ê³¼ ì½˜í…ì¸  ìŠ¤íƒ€ì¼]  
**ì¶”ì²œ ì˜ìƒ:** [ëŒ€í‘œ ì˜ìƒì´ë‚˜ ì‹œë¦¬ì¦ˆ]
**ì¶”ì²œ ì´ìœ :** [ì™œ ì´ ì±„ë„ì„ ì¶”ì²œí•˜ëŠ”ì§€]
**ë§í¬:** [ì±„ë„ ë§í¬ - ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ì±„ë„ë§Œ]

### 2. [ì±„ë„ëª…]
[ê°™ì€ í˜•ì‹ìœ¼ë¡œ...]

## ğŸ§ íŒŸìºìŠ¤íŠ¸ ì¶”ì²œ (2-3ê°œ)

### 1. [í”„ë¡œê·¸ë¨ëª…]
**í”Œë«í¼:** [ì–´ë””ì„œ ë“¤ì„ ìˆ˜ ìˆëŠ”ì§€]
**ì§„í–‰ì:** [ì§„í–‰ì ì •ë³´]
**íŠ¹ì§•:** [í”„ë¡œê·¸ë¨ íŠ¹ìƒ‰]
**ì¶”ì²œ ì—í”¼ì†Œë“œ:** [ì¶”ì²œí•  ë§Œí•œ ì—í”¼ì†Œë“œ]

## ğŸ“± ê¸°íƒ€ ì¶”ì²œ

**ì¸ìŠ¤íƒ€ê·¸ë¨ ê³„ì •:** [ê´€ë ¨ ì¸í”Œë£¨ì–¸ì„œë‚˜ ê³„ì •ë“¤]
**ì»¤ë®¤ë‹ˆí‹°:** [ê´€ë ¨ ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹°ë‚˜ ì¹´í˜]
**ì•±/ì›¹ì‚¬ì´íŠ¸:** [ìœ ìš©í•œ ê´€ë ¨ ì„œë¹„ìŠ¤ë“¤]

## ğŸ’¡ ì±„ë„ í™œìš© íŒ
[ì¶”ì²œ ì±„ë„ë“¤ì„ ì–´ë–»ê²Œ í™œìš©í•˜ë©´ ì¢‹ì„ì§€ ì¡°ì–¸]

ì‘ë‹µì€ ì¹œê·¼í•˜ê³  ì‹¤ìš©ì ì¸ í•œêµ­ì–´ë¡œ í•´ì£¼ì„¸ìš”.
ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ì±„ë„ë§Œ ì¶”ì²œí•˜ê³ , ì •í™•í•œ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”.
"""
                
                response = openai.ChatCompletion.create(
                    model="gpt-4o",
                    messages=[
                        {"role": "system", "content": system_prompt},
                        {"role": "user", "content": full_query}
                    ],
                    temperature=0.7,
                    max_tokens=1500
                )
                
                st.success("âœ… ë§ì¶¤ ì±„ë„ ì¶”ì²œ ì™„ë£Œ!")
                response_text = response.choices[0].message.content
                st.markdown(response_text)
                
                # ì¸ê¸° ì±„ë„ ëª¨ìŒ
                st.markdown("---")
                st.markdown("## ğŸ”¥ ë¶„ì•¼ë³„ ì¸ê¸° ì±„ë„ ëª¨ìŒ")
                
                tab1, tab2, tab3 = st.tabs(["ğŸƒâ€â™‚ï¸ ìš´ë™/ê±´ê°•", "ğŸ“š êµìœ¡/ìê¸°ê³„ë°œ", "ğŸµ ì—”í„°í…Œì¸ë¨¼íŠ¸"])
                
                with tab1:
                    fitness_channels = [
                        ("ë•…ë„ë¶€ë¶€", "https://www.youtube.com/@ddangkk", "í™ˆíŠ¸ë ˆì´ë‹"),
                        ("ë¹…ì”¨ìŠ¤ Bigsis", "https://www.youtube.com/@bigsis_official", "ë‹¤ì´ì–´íŠ¸ ìš´ë™"),
                        ("ì†Œë¯¸í• SomiFit", "https://www.youtube.com/@SomiFit", "ì „ì‹  ìš´ë™"),
                        ("ë°”ë¥¸ì²´í˜•TV", "https://www.youtube.com/@barunbody", "ì²´í˜•êµì •"),
                        ("í”¼ì§€ì˜¤TV", "https://www.youtube.com/@PhysioTV", "ë¬¼ë¦¬ì¹˜ë£Œ")
                    ]
                    for name, url, desc in fitness_channels:
                        st.markdown(f"ğŸ’ª **[{name}]({url})** - {desc}")
                
                with tab2:
                    edu_channels = [
                        ("ë¶íŠœë²„ ì±…ê·¸ë¦¼", "https://www.youtube.com/@bookgrim", "ì±… ë¦¬ë·°"),
                        ("ìŠˆì¹´ì›”ë“œ", "https://www.youtube.com/@shukaworld", "ìê¸°ê³„ë°œ"),
                        ("ì¡°ìŠ¹ì—°ì˜ íƒêµ¬ìƒí™œ", "https://www.youtube.com/@thethinker_jo", "ì§€ì‹ íƒêµ¬"),
                        ("ë¬¸ê³¼ë‚¨ì", "https://www.youtube.com/@moongwa", "ì¸ë¬¸í•™"),
                        ("ê¹€ë¯¸ê²½TV", "https://www.youtube.com/@kimmikyungtv", "ì„±ê³µ ë§ˆì¸ë“œ")
                    ]
                    for name, url, desc in edu_channels:
                        st.markdown(f"ğŸ“– **[{name}]({url})** - {desc}")
                
                with tab3:
                    entertainment_channels = [
                        ("ì¹¨ì°©ë§¨", "https://www.youtube.com/@ChimChakMan_Official", "ì˜ˆëŠ¥/í† í¬"),
                        ("ì›Œí¬ë§¨", "https://www.youtube.com/@workman", "ì§ì—… ì²´í—˜"),
                        ("ë¬¸ë³µí¬", "https://www.youtube.com/@eat_moon", "ë¨¹ë°©"),
                        ("ì›ì§€ì˜ í•˜ë£¨", "https://www.youtube.com/@oneday_oneji", "ì¼ìƒ ë¸Œì´ë¡œê·¸"),
                        ("ì¯”ì–‘", "https://www.youtube.com/@Tzuyang", "ëŒ€ì‹ê°€")
                    ]
                    for name, url, desc in entertainment_channels:
                        st.markdown(f"ğŸ¬ **[{name}]({url})** - {desc}")
                
                # ê°œì¸í™” ê¸°ë¡
                st.markdown("---")
                with st.expander("ğŸ“ ê´€ì‹¬ ì±„ë„ ë©”ëª¨"):
                    memo = st.text_area("ì¶”ì²œë°›ì€ ì±„ë„ ì¤‘ ê´€ì‹¬ ìˆëŠ” ê²ƒë“¤ì„ ë©”ëª¨í•´ë³´ì„¸ìš”:", 
                                       placeholder="ì˜ˆ: ë•…ë„ë¶€ë¶€ - ë§¤ì¼ ì•„ì¹¨ 10ë¶„ ë£¨í‹´ ë”°ë¼í•˜ê¸°\në¹…ì”¨ìŠ¤ - ì£¼ 3íšŒ í•˜ì²´ìš´ë™ ì˜ìƒ ì‹œì²­")
                    if st.button("ğŸ’¾ ë©”ëª¨ ì €ì¥"):
                        st.success("ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (ì„¸ì…˜ ì¢…ë£Œ ì‹œ ì‚­ì œë©ë‹ˆë‹¤)")
                
        except Exception as e:
            st.error(f"âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")
            st.info("ğŸ’¡ API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")

# í•˜ë‹¨ ì •ë³´
st.markdown("---")
col_info1, col_info2, col_info3 = st.columns(3)

with col_info1:
    st.markdown("### ğŸ¯ ì¶”ì²œ ë°›ëŠ” íŒ")
    st.info("""
    **ë” ë‚˜ì€ ì¶”ì²œì„ ìœ„í•´:**
    â€¢ êµ¬ì²´ì ì¸ ê´€ì‹¬ì‚¬ ëª…ì‹œ
    â€¢ í˜„ì¬ ìˆ˜ì¤€ì´ë‚˜ ê²½í—˜ ì–¸ê¸‰
    â€¢ ì„ í˜¸í•˜ëŠ” ì½˜í…ì¸  ìŠ¤íƒ€ì¼ ì„¤ëª…
    â€¢ í•™ìŠµ ëª©í‘œë‚˜ ì¦ê¸°ëŠ” ë°©ì‹ ê³µìœ 
    """)

with col_info2:
    st.markdown("### ğŸ“± í”Œë«í¼ë³„ íŠ¹ì§•")
    st.info("""
    **ê° í”Œë«í¼ì˜ ì¥ì :**
    â€¢ ìœ íŠœë¸Œ: ì‹œê°ì  í•™ìŠµ, ë‹¤ì–‘í•œ ê¸¸ì´
    â€¢ íŒŸìºìŠ¤íŠ¸: ì´ë™ ì¤‘ ì²­ì·¨, ê¹Šì´ ìˆëŠ” í† ë¡ 
    â€¢ ì¸ìŠ¤íƒ€ê·¸ë¨: ì§§ê³  íŠ¸ë Œë””í•œ ì½˜í…ì¸ 
    â€¢ ë„¤ì´ë²„TV: í•œêµ­ ì½˜í…ì¸  íŠ¹í™”
    """)

with col_info3:
    st.markdown("### ğŸ’¡ í™œìš© ê°€ì´ë“œ")
    st.info("""
    **ì±„ë„ êµ¬ë… í›„:**
    â€¢ ì•Œë¦¼ ì„¤ì •ìœ¼ë¡œ ìƒˆ ì˜ìƒ í™•ì¸
    â€¢ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ì–´ ì²´ê³„ì  ì‹œì²­
    â€¢ ëŒ“ê¸€ë¡œ í¬ë¦¬ì—ì´í„°ì™€ ì†Œí†µ
    â€¢ ìœ ì‚¬ ì±„ë„ íƒìƒ‰ìœ¼ë¡œ í™•ì¥
    """)

# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if 'selected_category' not in st.session_state:
    st.session_state.selected_category = ""
